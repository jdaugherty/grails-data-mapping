compileTestGroovy {
    configure(groovyOptions.forkOptions) {
        jvmArgs = [ '-Xmx768m']
    }
}

test {
    useJUnitPlatform()
    testLogging {
        exceptionFormat ='full'
    }
    if (isCiBuild) {
        maxParallelForks = 2
        jvmArgs = ['-server', '-Xmx1024M']
        forkEvery = 20
        afterSuite {
            System.out.print('.')
            System.out.flush()
        }
    } else {
        maxParallelForks = 4
        forkEvery = 100
        jvmArgs = ['-server', '-Xmx2048M']
    }
    if(System.getProperty("debug.tests")) {
        jvmArgs '-Xmx2g', '-Xdebug', '-Xnoagent', '-Djava.compiler=NONE',
                '-Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=5005'
    }
}